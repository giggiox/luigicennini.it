[{"content":"\u003ch1 id=\"introduzione\"\u003eIntroduzione\u003c/h1\u003e\n\u003cp\u003eL\u0026rsquo;obiettivo di questo progetto è quello di sviluppare un\u0026rsquo;alternativa più economica ai sistemi di telemetria disponibili sul mercato per le mountain bike e le moto da cross.\u003c/p\u003e\n\u003cp\u003eI sistemi di telemetria per le mountain bike consentono di monitorare e acquisire dati sulla posizione della forcella e dell\u0026rsquo;ammortizzatore della bici durante la guida. Questi dati sono fondamentali per gli appassionati di sport off-road e gli atleti professionisti, in quanto forniscono informazioni preziose per analizzare e migliorare le prestazioni.\u003c/p\u003e\n\u003cp\u003eAttualmente, molti sistemi di telemetria, come ad esempio \u003ca href=\"https://www.bybtech.it/\"\u003ebyb telemetry\u003c/a\u003e, utilizzano costosi potenziometri lineari per misurare con precisione la posizione della forcella e dell\u0026rsquo;ammortizzatore.\u003c/p\u003e\n\u003cp\u003eAltri utenti su internet hanno provato altri modi per ottenere un buon risultato, per esempio un \u003ca href=\"https://www.vitalmtb.com/forums/The-Hub,2/DIY-mtb-telemetry-data,11126\"\u003esensore LiDar\u003c/a\u003e, con dei risultati però non troppo incoraggianti in quanto troppo rumorosi.\u003c/p\u003e\n\u003cp\u003eDunque, dopo un\u0026rsquo;attenta valutazione, ho concluso che l\u0026rsquo;utilizzo di un encoder rotativo rappresenta un\u0026rsquo;alternativa più vantaggiosa dal punto di vista economico.\u003c/p\u003e\n\u003cp\u003eLa ragione principale di questa scelta è che gli encoder rotativi sono meno costosi rispetto ai potenziometri lineari e offrono comunque una buona precisione nella misurazione della posizione. Inoltre, gli encoder rotativi sono generalmente più robusti e meno soggetti a danni rispetto agli encoder lineari, che possono essere più fragili e suscettibili a guasti in ambienti off-road.\u003c/p\u003e\n\u003ch1 id=\"pre---prototipazione\"\u003epre - prototipazione\u003c/h1\u003e\n\u003cp\u003ePrima di procedere con la prototipazione del sensore della forcella, ho eseguito un\u0026rsquo;analisi di fattibilità per valutare la possibilità di realizzare questo progetto.\u003c/p\u003e\n\u003cp\u003eCome punto di partenza, ho selezionato un encoder rotativo affidabile: l\u0026rsquo;LPD3806. Questo tipo di encoder offre una risoluzione di 600 PPR (pulses per revolution). Utilizzando una puleggia con un diametro di 9,4 mm, si ottiene una densità di circa 30 rilevazioni per millimetro di movimento della forcella. Questo perché l\u0026rsquo;encoder genera un segnale di quadratura che può essere letto sia sul fronte di salita che su quello di discesa. Sfruttando entrambi i fronti, otteniamo una risoluzione quadruplicata dell\u0026rsquo;encoder, ovvero 24000 PPR (600 PPR * 4).\u003c/p\u003e\n\u003cp\u003eCalcolando il numero di osservazioni possibili per ogni millimetro di movimento della forcella, otteniamo il seguente risultato:\u003c/p\u003e\n\u003cp\u003e$$ \\frac{600 * 4}{\\pi* 9.4} \\approx 30 $$\u003c/p\u003e\n\u003cp\u003eAd esempio, considerando una forcella di 150 mm di escursione, si avranno circa 12190 rilevazioni (questo valore sarà utilizzato nel codice).\u003c/p\u003e\n\u003cp\u003eÈ importante notare che aumentando il diametro della puleggia accoppiata all\u0026rsquo;encoder, si riduce la densità di rilevazioni per millimetro di movimento. Inoltre, bisogna considerare la velocità massima di risposta dell\u0026rsquo;encoder, la quale determina la velocità lineare massima che la forcella può raggiungere. Nel caso dell\u0026rsquo;LPD3806, la velocità massima è di:\u003c/p\u003e\n\u003cp\u003e​$$ 2000 RPM = 2000/60 RPS = 2000* (\\pi*9.4) /60 \\frac{mm}{s} \\approx 983 \\frac{mm}{s} $$\u003c/p\u003e\n\u003cp\u003eSe si utilizza una puleggia con un diametro ridotto, si otterrà una velocità lineare massima superiore per la forcella.\u003c/p\u003e\n\u003cp\u003eCon queste informazioni iniziali, ho dunque iniziato il processo di prototipazione.\u003c/p\u003e\n\u003ch1 id=\"prototipazione\"\u003eprototipazione\u003c/h1\u003e\n\u003cp\u003ePer la prototipazione del sensore della forcella, ho utilizzato il software \u003ca href=\"https://www.autodesk.it/products/fusion-360/overview\"\u003efusion 360\u003c/a\u003e. Dopo diverse iterazioni, sono giunto al seguente risultato:\u003c/p\u003e\n\r\n \r\n\u003ccenter\u003e\r\n\u003cimg src=\"/images/projects/forktelemetry/forkSensor.jpg\"  width=\"80%\" \u003e\r\n\u003c/center\u003e\r\n\n\u003cp\u003ePer il design, mi sono ispirato al movimento degli assi di una stampante 3D e ho integrato un meccanismo di tensionamento della cinghia, tipico di questo tipo di stampanti.\u003c/p\u003e\n\u003cp\u003eSuccessivamente, ho utilizzato Arduino Nano per realizzare un Proof of Concept (POC) funzionante. Nel complesso, il sistema è composto da 2 switch, 1 modulo SD, 1 Arduino Nano, 1 batteria da 9 volt e l\u0026rsquo;encoder LPD3806.\nDove:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003euno switch serve per accendere il sistema\u003c/li\u003e\n\u003cli\u003el\u0026rsquo;altro switch abilita la scrittura della posizione dell\u0026rsquo;encoder con la codifica scelta ( [posizione_encoder,]) nella scheda SD. Questo switch dovrà essere attiviato prima dell\u0026rsquo;inizio della discesa e spento subito dopo.\u003c/li\u003e\n\u003c/ul\u003e\n\r\n \r\n\u003ccenter\u003e\r\n\u003cimg src=\"/images/projects/forktelemetry/forktelemetry-schematics.png\"  width=\"60%\" \u003e\r\n\u003c/center\u003e\r\n\n\u003cp\u003eA questo punto, ho progettato anche una scatola di acquisizione utilizzando Fusion 360.\n\r\n \r\n\u003ccenter\u003e\r\n\u003cimg src=\"/images/projects/forktelemetry/box_fusion.PNG\"  width=\"80%\" \u003e\r\n\u003c/center\u003e\r\n\nLa scatola, che è disegnata in modo da essere fissata con 2 fascette al tubo superiore della bici, contiene tutti i componenti (tranne l\u0026rsquo;encoder) e rende accessibile dall\u0026rsquo;esterno i 2 switch.\n\r\n \r\n\u003ccenter\u003e\r\n\u003cimg src=\"/images/projects/forktelemetry/openbox_fusion.PNG\"  width=\"80%\" \u003e\r\n\u003c/center\u003e\r\n\u003c/p\u003e\n\u003ch1 id=\"stampa-e-codice\"\u003estampa e codice\u003c/h1\u003e\n\u003cp\u003eUna volta stampato (e assemblato) il sensore e la scatola di acquisizione saldando i componenti su una millefori\u003c/p\u003e\n\r\n \r\n\u003ccenter\u003e\r\n\u003cimg src=\"/images/projects/forktelemetry/collage.png\"  width=\"80%\" \u003e\r\n\u003c/center\u003e\r\n\n\u003cp\u003eil tutto si presenta in questo modo:\u003c/p\u003e\n\r\n \r\n\u003ccenter\u003e\r\n\u003cimg src=\"/images/projects/forktelemetry/laydown.jpg\"  width=\"80%\" \u003e\r\n\u003c/center\u003e\r\n\n\u003cp\u003eIl funzionamento una volta montati sulla MTB è il seguente:\u003c/p\u003e\n\r\n \r\n\u003ccenter\u003e\r\n\u003cvideo width=30% controls\u003e\r\n    \u003csource src=\"/images/projects/forktelemetry/video.mp4\" type=\"video/mp4\" \u003e\r\n    Your browser does not support the video tag.  \r\n\u003c/video\u003e\r\n\u003c/center\u003e\r\n\n\u003cp\u003eIl codice invece è il seguente.\nNotare che per avere una massima velocità in lettura dell\u0026rsquo;encoder si è utilizzata la tecnica della manipolazione delle porte.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-cpp\" data-lang=\"cpp\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#include\u003c/span\u003e \u003cspan style=\"color:#75715e\"\u003e\u0026lt;SPI.h\u0026gt;\u003c/span\u003e\u003cspan style=\"color:#75715e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#include\u003c/span\u003e \u003cspan style=\"color:#75715e\"\u003e\u0026lt;SD.h\u0026gt;\u003c/span\u003e\u003cspan style=\"color:#75715e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#include\u003c/span\u003e \u003cspan style=\"color:#75715e\"\u003e\u0026lt;String.h\u0026gt;\u003c/span\u003e\u003cspan style=\"color:#75715e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#define encoderPinA 3\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#define encoderPinB 2\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#define buttonPin 7\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#define SD_PIN 10\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eFile logFile;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003ebool\u003c/span\u003e enableWriteToSD\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003efalse;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e newDirectoryName\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e newFileName\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003ebool\u003c/span\u003e startRecord;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003evolatile\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003elong\u003c/span\u003e encoderPosition\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003evolatile\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003ebool\u003c/span\u003e aStatePrev,bStatePrev,aState,bState;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003evoid\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003esetup\u003c/span\u003e() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  Serial.begin(\u003cspan style=\"color:#ae81ff\"\u003e9600\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#75715e\"\u003e//setup rotary encoder\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e  DDRD \u003cspan style=\"color:#f92672\"\u003e\u0026amp;=\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e~\u003c/span\u003e((\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e encoderPinA) \u003cspan style=\"color:#f92672\"\u003e|\u003c/span\u003e (\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e encoderPinB));\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#75715e\"\u003e// Abilita i pull-up interni\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e  PORTD \u003cspan style=\"color:#f92672\"\u003e|=\u003c/span\u003e (\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e encoderPinA) \u003cspan style=\"color:#f92672\"\u003e|\u003c/span\u003e (\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e encoderPinB);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  attachInterrupt(digitalPinToInterrupt(encoderPinA),handleEncoderInterrupt,CHANGE);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  attachInterrupt(digitalPinToInterrupt(encoderPinB),handleEncoderInterrupt,CHANGE);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#75715e\"\u003e//setup SD\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e  \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e(\u003cspan style=\"color:#f92672\"\u003e!\u003c/span\u003eSD.begin(SD_PIN)){ \u003cspan style=\"color:#66d9ef\"\u003ewhile\u003c/span\u003e(true); }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003ewhile\u003c/span\u003e(SD.exists(String(newDirectoryName))){ newDirectoryName\u003cspan style=\"color:#f92672\"\u003e++\u003c/span\u003e; }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (SD.mkdir(String(newDirectoryName))){\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    Serial.print(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Created new directory: \u0026#34;\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    Serial.println(newDirectoryName);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#75715e\"\u003e//setup record button\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e  DDRD \u003cspan style=\"color:#f92672\"\u003e\u0026amp;=\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e~\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e buttonPin);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  PORTD \u003cspan style=\"color:#f92672\"\u003e|=\u003c/span\u003e (\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e buttonPin);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  Serial.println(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;setup completed\u0026#34;\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003evoid\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eloop\u003c/span\u003e() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  startRecord\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003ePIND\u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u0026lt;\u003c/span\u003ebuttonPin);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e(startRecord \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e!\u003c/span\u003eenableWriteToSD){\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    logFile \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e SD.open(String(newDirectoryName) \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;/\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e  String(newFileName\u003cspan style=\"color:#f92672\"\u003e++\u003c/span\u003e) \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;.txt\u0026#34;\u003c/span\u003e, FILE_WRITE);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (logFile) { Serial.println(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Writing to \u0026#34;\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e String(newFileName\u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e)); }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    enableWriteToSD\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003etrue;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003eelse\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e(startRecord \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e enableWriteToSD) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e     logFile.print(String(encoderPosition)\u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;,\u0026#34;\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003eelse\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e(\u003cspan style=\"color:#f92672\"\u003e!\u003c/span\u003estartRecord \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e enableWriteToSD){\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    enableWriteToSD\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003efalse;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    logFile.close();\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003evoid\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ehandleEncoderInterrupt\u003c/span\u003e(){\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#75715e\"\u003e// Leggi lo stato corrente dei segnali A e B\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e  aState \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e PIND \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u003c/span\u003e (\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e encoderPinA);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  bState \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e PIND \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u003c/span\u003e (\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e encoderPinB);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#75715e\"\u003e// Verifica se il fronte di salita è avvenuto sul segnale A\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e  \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (aState \u003cspan style=\"color:#f92672\"\u003e!=\u003c/span\u003e aStatePrev) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    aStatePrev \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e aState;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#75715e\"\u003e// Verifica il cambiamento di direzione dell\u0026#39;encoder\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e    \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (aStatePrev \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e bStatePrev) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      encoderPosition\u003cspan style=\"color:#f92672\"\u003e--\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    } \u003cspan style=\"color:#66d9ef\"\u003eelse\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      encoderPosition\u003cspan style=\"color:#f92672\"\u003e++\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#75715e\"\u003e// Memorizza lo stato corrente dei segnali A e B per il prossimo interrupt\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e  bStatePrev \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e bState;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch1 id=\"primi-test-e-risultati\"\u003eprimi test e risultati\u003c/h1\u003e\n\u003cp\u003eDopo aver attivato  lo switch per avviare la registrazione il codice crea un file di log all\u0026rsquo;interno della sua cartella che non è altro che il valore della posizione dell\u0026rsquo;encoder separato da virgole.\u003c/p\u003e\n\u003cp\u003eHo scritto un sito web in javascript utilizzando la libreria \u003ca href=\"https://plotly.com/javascript/\"\u003ePlotly JS\u003c/a\u003e che serve per visualizzare questi dati (\u003ca href=\"https://github.com/giggiox/fork-telemetry/tree/main/web\"\u003eLink GitHub al codice del sito\u003c/a\u003e).\nQuindi per esempio il video precedente produce un file di log che è poi possibile aprire nel sito e genera questo output:\n\r\n \r\n\u003ccenter\u003e\r\n\u003cimg src=\"/images/projects/forktelemetry/plot.png\"  width=\"80%\" \u003e\r\n\u003c/center\u003e\r\n\u003c/p\u003e\n\u003cp\u003eInoltre vengono mostrati il numero di bottom out avuti (in questo caso zero), il valore più usato durante una registrazione e la percentuale di forca usata (in questo esempio più di 26 mm di una forca di 150mm quindi circa il 18%).\u003c/p\u003e\n\u003cp\u003eHo anche scritto uno script python (\u003ca href=\"https://github.com/giggiox/fork-telemetry/blob/main/videoEdit.ipynb\"\u003eLink GitHub allo script\u003c/a\u003e) che utilizza \u003ca href=\"https://pypi.org/project/Pillow/\"\u003ePillow\u003c/a\u003e e \u003ca href=\"https://pypi.org/project/opencv-python/\"\u003ecv2\u003c/a\u003e.\nQuesto script serve per aggiungere la telemetria rilevata a un video, con risultato una cosa così:\n\r\n \r\n\u003ccenter\u003e\r\n\u003cvideo width=30% controls\u003e\r\n    \u003csource src=\"/images/projects/forktelemetry/videoTelemetry.mp4\" type=\"video/mp4\" \u003e\r\n    Your browser does not support the video tag.  \r\n\u003c/video\u003e\r\n\u003c/center\u003e\r\n\u003c/p\u003e\n\u003cp\u003eQuello che fa è innanzitutto generare 101 immagini del rettangolo con dentro la percentuale (da 0% a 100%). Poi unisce queste immagini creando un video dove ogni immagine corrisponde a un dato rilevato dal sensore.\u003c/p\u003e\n\u003ch1 id=\"test-sul-campo\"\u003etest sul campo\u003c/h1\u003e\n\u003cp\u003eProvando a fare i primi test sul campo ovvero provando il sistema su una vera discesa da enduro sono sorti i primi problemi  e limitazioni dell\u0026rsquo;hardware usato (dell\u0026rsquo;arduino, in particolare).\nInfatti per impatti troppo veloci, il conto degli impulsi ricevuti dall\u0026rsquo;encoder inizia a \u0026ldquo;driftare\u0026rdquo; e diventare sempre più negativo.\u003c/p\u003e\n\r\n \r\n\u003ccenter\u003e\r\n\u003cimg src=\"/images/projects/forktelemetry/testSulCampo.PNG\"  width=\"80%\" \u003e\r\n\u003c/center\u003e\r\n\n\u003cp\u003eQuesto perchè la risposta dell\u0026rsquo;encoder ha una frequenza tra 0-20KHz. Questo significa che tra un fronte di salita e un altro c\u0026rsquo;è un tempo di almeno 50 microsecondi.\nAnche ammettendo di leggere solo i fronti di salita del segnale A (dunque riducendo la stima della precisione fatta in precedenza di 1/4) l\u0026rsquo;arduino non è in grado di svolgere in questo poco tempo tutte le operazioni richieste.\nInfatti dovrebbe\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003efare una \u003ccode\u003edigitalRead()\u003c/code\u003e sul pin del segnale B\u003c/li\u003e\n\u003cli\u003escrivere sull\u0026rsquo;SD la posizione\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eNelle 2 prossime provo ad analizzare il codice e capire perchè l\u0026rsquo;arduino non è il modo corretto di procedere.\u003c/p\u003e\n\u003ch2 id=\"digitalread\"\u003edigitalRead\u003c/h2\u003e\n\u003cp\u003ePer esempio guardiamo quanto tempo prende una digitalRead() usando la manipolazione delle porte.\nPossiamo per esempio prendere questo codice arduino che fa una digitalRead() dell\u0026rsquo;encoderPinB e se risulta HIGH allora aggiunge 1 all\u0026rsquo;encoderPosition, altrimenti diminusice di 1 la variabile.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-cpp\" data-lang=\"cpp\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003evoid\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ehandleEncoderInterrupt\u003c/span\u003e(){\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#75715e\"\u003e// Leggi lo stato corrente del segnale B\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e  PIND \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u003c/span\u003e (\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e encoderPinB) \u003cspan style=\"color:#f92672\"\u003e?\u003c/span\u003e encoderPosition \u003cspan style=\"color:#f92672\"\u003e+=\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e encoderPosition \u003cspan style=\"color:#f92672\"\u003e-=\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003ee decompilarlo \u003ccode\u003eC:\\Users\\luigi\\AppData\\Local\\Temp\\arduino_build_211859\u0026gt;\u0026quot;C:\\Program Files (x86)\\Arduino\\hardware\\tools\\avr\\bin\\avr-objdump.exe\u0026quot; -S codice_test.ino.elf\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003eottenendo\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-asm\" data-lang=\"asm\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ea8:   \u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e4\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003ea\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e9\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003eb\u003c/span\u003e           \u003cspan style=\"color:#66d9ef\"\u003esbis\u003c/span\u003e    \u003cspan style=\"color:#ae81ff\"\u003e0x09\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e \u003cspan style=\"color:#75715e\"\u003e; 9\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003eaa:   \u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e0\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003ec\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003ec0\u003c/span\u003e           \u003cspan style=\"color:#66d9ef\"\u003erjmp\u003c/span\u003e    .\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e+\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e24\u003c/span\u003e            \u003cspan style=\"color:#75715e\"\u003e; 0xc4 \u0026lt;_Z22handleEncoderInterruptv+0x1c\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003eac:   \u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e80\u003c/span\u003e \u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e91\u003c/span\u003e \u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e04\u003c/span\u003e \u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e01\u003c/span\u003e     \u003cspan style=\"color:#a6e22e\"\u003elds\u003c/span\u003e     \u003cspan style=\"color:#66d9ef\"\u003er24\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x0104\u003c/span\u003e     \u003cspan style=\"color:#75715e\"\u003e; 0x800104 \u0026lt;__data_end\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003eb0:   \u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e90\u003c/span\u003e \u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e91\u003c/span\u003e \u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e05\u003c/span\u003e \u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e01\u003c/span\u003e     \u003cspan style=\"color:#a6e22e\"\u003elds\u003c/span\u003e     \u003cspan style=\"color:#66d9ef\"\u003er25\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x0105\u003c/span\u003e     \u003cspan style=\"color:#75715e\"\u003e; 0x800105 \u0026lt;__data_end+0x1\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003eb4:   \u003cspan style=\"color:#a6e22e\"\u003ea0\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e91\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e06\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e01\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003ex\u003c/span\u003e     \u003cspan style=\"color:#66d9ef\"\u003elds\u003c/span\u003e     \u003cspan style=\"color:#66d9ef\"\u003er26\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x0106\u003c/span\u003e     \u003cspan style=\"color:#75715e\"\u003e; 0x800106 \u0026lt;__data_end+0x2\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003eb8:   \u003cspan style=\"color:#a6e22e\"\u003eb0\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e91\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e07\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e01\u003c/span\u003e     \u003cspan style=\"color:#66d9ef\"\u003elds\u003c/span\u003e     \u003cspan style=\"color:#66d9ef\"\u003er27\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x0107\u003c/span\u003e     \u003cspan style=\"color:#75715e\"\u003e; 0x800107 \u0026lt;__data_end+0x3\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003ebc:   \u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e01\u003c/span\u003e \u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e96\u003c/span\u003e           \u003cspan style=\"color:#a6e22e\"\u003eadiw\u003c/span\u003e    \u003cspan style=\"color:#66d9ef\"\u003er24\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x01\u003c/span\u003e       \u003cspan style=\"color:#75715e\"\u003e; 1\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003ebe:   \u003cspan style=\"color:#a6e22e\"\u003ea1\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003ed\u003c/span\u003e           \u003cspan style=\"color:#66d9ef\"\u003eadc\u003c/span\u003e     \u003cspan style=\"color:#66d9ef\"\u003er26\u003c/span\u003e, \u003cspan style=\"color:#66d9ef\"\u003er1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ec0:   \u003cspan style=\"color:#a6e22e\"\u003eb1\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003ed\u003c/span\u003e           \u003cspan style=\"color:#66d9ef\"\u003eadc\u003c/span\u003e     \u003cspan style=\"color:#66d9ef\"\u003er27\u003c/span\u003e, \u003cspan style=\"color:#66d9ef\"\u003er1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ec2:   \u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e0\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eb\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003ec0\u003c/span\u003e           \u003cspan style=\"color:#66d9ef\"\u003erjmp\u003c/span\u003e    .\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e+\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e22\u003c/span\u003e            \u003cspan style=\"color:#75715e\"\u003e; 0xda \u0026lt;_Z22handleEncoderInterruptv+0x32\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003ec4:   \u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e80\u003c/span\u003e \u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e91\u003c/span\u003e \u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e04\u003c/span\u003e \u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e01\u003c/span\u003e     \u003cspan style=\"color:#a6e22e\"\u003elds\u003c/span\u003e     \u003cspan style=\"color:#66d9ef\"\u003er24\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x0104\u003c/span\u003e     \u003cspan style=\"color:#75715e\"\u003e; 0x800104 \u0026lt;__data_end\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003ec8:   \u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e90\u003c/span\u003e \u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e91\u003c/span\u003e \u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e05\u003c/span\u003e \u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e01\u003c/span\u003e     \u003cspan style=\"color:#a6e22e\"\u003elds\u003c/span\u003e     \u003cspan style=\"color:#66d9ef\"\u003er25\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x0105\u003c/span\u003e     \u003cspan style=\"color:#75715e\"\u003e; 0x800105 \u0026lt;__data_end+0x1\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003ecc:   \u003cspan style=\"color:#a6e22e\"\u003ea0\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e91\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e06\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e01\u003c/span\u003e     \u003cspan style=\"color:#66d9ef\"\u003elds\u003c/span\u003e     \u003cspan style=\"color:#66d9ef\"\u003er26\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x0106\u003c/span\u003e     \u003cspan style=\"color:#75715e\"\u003e; 0x800106 \u0026lt;__data_end+0x2\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003ed0:   \u003cspan style=\"color:#a6e22e\"\u003eb0\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e91\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e07\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e01\u003c/span\u003e     \u003cspan style=\"color:#66d9ef\"\u003elds\u003c/span\u003e     \u003cspan style=\"color:#66d9ef\"\u003er27\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x0107\u003c/span\u003e     \u003cspan style=\"color:#75715e\"\u003e; 0x800107 \u0026lt;__data_end+0x3\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003ed4:   \u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e01\u003c/span\u003e \u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e97\u003c/span\u003e           \u003cspan style=\"color:#a6e22e\"\u003esbiw\u003c/span\u003e    \u003cspan style=\"color:#66d9ef\"\u003er24\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x01\u003c/span\u003e       \u003cspan style=\"color:#75715e\"\u003e; 1\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003ed6:   \u003cspan style=\"color:#a6e22e\"\u003ea1\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e09\u003c/span\u003e           \u003cspan style=\"color:#66d9ef\"\u003esbc\u003c/span\u003e     \u003cspan style=\"color:#66d9ef\"\u003er26\u003c/span\u003e, \u003cspan style=\"color:#66d9ef\"\u003er1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ed8:   \u003cspan style=\"color:#a6e22e\"\u003eb1\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e09\u003c/span\u003e           \u003cspan style=\"color:#66d9ef\"\u003esbc\u003c/span\u003e     \u003cspan style=\"color:#66d9ef\"\u003er27\u003c/span\u003e, \u003cspan style=\"color:#66d9ef\"\u003er1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eda:   \u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e80\u003c/span\u003e \u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e93\u003c/span\u003e \u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e04\u003c/span\u003e \u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e01\u003c/span\u003e     \u003cspan style=\"color:#a6e22e\"\u003ests\u003c/span\u003e     \u003cspan style=\"color:#ae81ff\"\u003e0x0104\u003c/span\u003e, \u003cspan style=\"color:#66d9ef\"\u003er24\u003c/span\u003e     \u003cspan style=\"color:#75715e\"\u003e; 0x800104 \u0026lt;__data_end\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003ede:   \u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e90\u003c/span\u003e \u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e93\u003c/span\u003e \u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e05\u003c/span\u003e \u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e01\u003c/span\u003e     \u003cspan style=\"color:#a6e22e\"\u003ests\u003c/span\u003e     \u003cspan style=\"color:#ae81ff\"\u003e0x0105\u003c/span\u003e, \u003cspan style=\"color:#66d9ef\"\u003er25\u003c/span\u003e     \u003cspan style=\"color:#75715e\"\u003e; 0x800105 \u0026lt;__data_end+0x1\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003ee2:   \u003cspan style=\"color:#a6e22e\"\u003ea0\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e93\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e06\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e01\u003c/span\u003e     \u003cspan style=\"color:#66d9ef\"\u003ests\u003c/span\u003e     \u003cspan style=\"color:#ae81ff\"\u003e0x0106\u003c/span\u003e, \u003cspan style=\"color:#66d9ef\"\u003er26\u003c/span\u003e     \u003cspan style=\"color:#75715e\"\u003e; 0x800106 \u0026lt;__data_end+0x2\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003ee6:   \u003cspan style=\"color:#a6e22e\"\u003eb0\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e93\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e07\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e01\u003c/span\u003e     \u003cspan style=\"color:#66d9ef\"\u003ests\u003c/span\u003e     \u003cspan style=\"color:#ae81ff\"\u003e0x0107\u003c/span\u003e, \u003cspan style=\"color:#66d9ef\"\u003er27\u003c/span\u003e     \u003cspan style=\"color:#75715e\"\u003e; 0x800107 \u0026lt;__data_end+0x3\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003eea:   \u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e08\u003c/span\u003e \u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e95\u003c/span\u003e           \u003cspan style=\"color:#a6e22e\"\u003eret\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eIn particolare le istruzioni che fanno la lettura digitale dell\u0026rsquo;encoderPinB sono dalla 2a alla 6a, ovvero le 4 istruzioni che utilizzano \u003ccode\u003elds\u003c/code\u003e (Load direct from SRAM).\nDal \u003ca href=\"https://ww1.microchip.com/downloads/en/DeviceDoc/Atmel-7810-Automotive-Microcontrollers-ATmega328P_Datasheet.pdf\"\u003edatasheet dell\u0026rsquo;ATmega328 (pagina 283)\u003c/a\u003e possiamo vedere che queste istruzioni prendono esattamente 2 cicli di clock.\u003c/p\u003e\n\r\n \r\n\u003ccenter\u003e\r\n\u003cimg src=\"/images/projects/forktelemetry/datasheet.PNG\"  width=\"80%\" \u003e\r\n\u003c/center\u003e\r\n\n\u003cp\u003eDunque essendo un microcontrollore a 16Mhz (1 ciclo di clock richiede 1/16.000.000 di secondo, cioè 62,5 nanosecondi), allora quelle 4 istruzioni richiedono 8 cicli  * 62,5 ns/ciclo = 500 ns.\u003c/p\u003e\n\u003cp\u003eDa questa analisi è possibile dedurre che la digitalRead() non è il collo di bottiglia nel codice.\u003c/p\u003e\n\u003ch2 id=\"scrittura-sd\"\u003escrittura SD\u003c/h2\u003e\n\u003cp\u003eGuardiamo invece quanto tempo impiega una scrittura sull\u0026rsquo;SD, per avere un numero più o meno approssimativo possiamo per esempio stampare il numero di millisecondi prima e dopo l\u0026rsquo;esecuzione della scritura della posizione nella memoria.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-cpp\" data-lang=\"cpp\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSerial.println(millis());\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003elogFile.print(String(encoderPosition)\u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;,\u0026#34;\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSerial.println(millis());\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eE possiamo vedere che effettivamente il collo di bottiglia è  proprio in questa chiamata che può arrivare a prendere anche 200 millisecondi.\u003c/p\u003e\n\u003ch1 id=\"sviluppi-futuri\"\u003esviluppi futuri\u003c/h1\u003e\n\u003cp\u003eIn futuro\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eusare un microcontrollore con più core, per esempio un esp32 dove un core viene dedicato alla lettura del segnale dell\u0026rsquo;encoder e un altro alla campionatura (che a questo punto è possibile fare in maniera costante per esempio 1000 volte al secondo) e scrittura sull\u0026rsquo;SD della posizione dell\u0026rsquo;encoder.\u003c/li\u003e\n\u003cli\u003eutilizzare un modulo bluetooth per comunicare i dati a un\u0026rsquo; applicazione android, anche in real time.\u003c/li\u003e\n\u003cli\u003eaggiungere un modulo GPS in modo da poter avere nel pannello di analisi non solo la posizione della forca metro per metro ma anche la posizione del rider lungo la discesa.\u003c/li\u003e\n\u003cli\u003eredesign del sensore. Il primo design fatto è stato fatto top-down (anche perchè era la prima volta che utilizzavo fusion360 e anche la prima che disegnavo davvero qualcosa di funzionale) e con forme a scatola (non strutturalmente solide) e può essere di gran lunga migliorato. Per esempio utilizzando una guida lineare è possibile ridurre la complessità del sensore (insieme al peso) ma anche i gradi di libertà del sistema.  Qui sotto il design di una possibile v2 del progetto utilizzando una guida lineare di 6mm.\u003c/li\u003e\n\u003c/ul\u003e\n\r\n \r\n\u003ccenter\u003e\r\n\u003cimg src=\"/images/projects/forktelemetry/rev2.PNG\"  width=\"80%\" \u003e\r\n\u003c/center\u003e\r\n\n","description":"","image":"/images/projects/forktelemetry/copertina.jpg","permalink":"/projects/fork-telemetry/","title":"fork telemetry"},{"content":"\u003ch1 id=\"graphtheory-visualizer\"\u003egraphTheory-Visualizer\u003c/h1\u003e\n\u003cp\u003eIl progetto è stato fatto per visualizzare le operazioni che possono essere fatte su un grafo, come BFS, DFS, Kruskal e Dijkstra.\u003c/p\u003e\n\u003cp\u003eL\u0026rsquo;obiettivo è quello di avere un update real time delle varie operazioni, in modo che se il grafo cambia mentre vi si sta svolgendo un\u0026rsquo; operazione, anche il risultato dell\u0026rsquo;operazione cambia.\u003c/p\u003e\n\u003cp\u003eIl progetto è attivo sulle GitHub pages e può essere accessibile una demo da questo link  (fruibile più semplicemente da desktop): \u003ca href=\"https://giggiox.github.io/graphTheory-Visualizer/\"\u003ehttps://giggiox.github.io/graphTheory-Visualizer/\u003c/a\u003e  \u003cbr/\u003e\u003cbr/\u003e\u003c/p\u003e\n\u003cp\u003eL\u0026rsquo;interfaccia grafica si presenta in questo modo:\n\u003cimg src=\"/images/projects/graphtheoryvisualizer/interface.gif\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003ee permette:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003ecreare nuovo vertice (bottone a schermo \u003ccode\u003evertex\u003c/code\u003e)\u003c/li\u003e\n\u003cli\u003ecreare un arco tra due vertici (bottone a schermo \u003ccode\u003eedge\u003c/code\u003e) cliccando prima sul primo vertice e poi sul secondo\u003c/li\u003e\n\u003cli\u003erimuovere un arco tra due vertici cliccandoci sopra\u003c/li\u003e\n\u003cli\u003eimpostare il grafo come pesato e/o diretto (switch presenti a schermo)\u003c/li\u003e\n\u003cli\u003evedere la lista di adiacenza come dropdown. Notare come se il grafo cambia per esempio se si elimina un arco, la lista cambia in tempo reale\u003c/li\u003e\n\u003cli\u003evisualizzare le operazioni possibili su un grafo. E\u0026rsquo; necessario scegliere l\u0026rsquo;operazione con il dropdown presente nella navbar e poi iniziare la visualizzazione. Notare come anche in questo caso, per esempio se si sceglie di visualizzare l\u0026rsquo;algoritmo Dijkstra e nel mentre cambiamo il grafico muovendo i vertici, allora anche l\u0026rsquo;output dell\u0026rsquo;algoritmo cambia in tempo reale. L\u0026rsquo;output di un algoritmo viene visualizzato sul grafo evidenziando vertici e archi di blu.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"esempi\"\u003eesempi\u003c/h2\u003e\n\u003cp\u003edepth-first search (DFS):\n\u003cimg src=\"/images/projects/graphtheoryvisualizer/dfs.gif\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003edijkstra shortest path between 2 vertices:\n\u003cimg src=\"/images/projects/graphtheoryvisualizer/dijkstra.gif\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003ekruskal minimum spanning tree:\n\u003cimg src=\"/images/projects/graphtheoryvisualizer/kruskal.gif\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eProgetto fatto usando \u003ca href=\"https://p5js.org/\"\u003ep5js\u003c/a\u003e e \u003ca href=\"https://www.typescriptlang.org/\"\u003eTypeScript\u003c/a\u003e.\u003c/p\u003e\n","description":"","image":"/images/projects/graphtheoryvisualizer/graph.png","permalink":"/projects/graph-theory-visualizer/","title":"graph theory visualizer"}]